{"version":3,"file":"wpfeatureloop.es.js","sources":["../src/wpfeatureloop.js"],"sourcesContent":["/**\n * WPFeatureLoop SDK\n * A feature voting widget for WordPress plugins\n *\n * @version 1.1.0\n * @license MIT\n */\n\n(function (global, factory) {\n  typeof exports === \"object\" && typeof module !== \"undefined\"\n    ? (module.exports = factory())\n    : typeof define === \"function\" && define.amd\n      ? define(factory)\n      : ((global =\n          typeof globalThis !== \"undefined\" ? globalThis : global || self),\n        (global.WPFeatureLoop = factory()));\n})(this, function () {\n  \"use strict\";\n\n  /**\n   * Embedded Styles\n   */\n  const styles = `:root{--wfl-primary:#6366f1;--wfl-primary-hover:#4f46e5;--wfl-primary-light:#eef2ff;--wfl-success:#10b981;--wfl-warning:#f59e0b;--wfl-danger:#ef4444;--wfl-gray-50:#f9fafb;--wfl-gray-100:#f3f4f6;--wfl-gray-200:#e5e7eb;--wfl-gray-300:#d1d5db;--wfl-gray-400:#9ca3af;--wfl-gray-500:#6b7280;--wfl-gray-600:#4b5563;--wfl-gray-700:#374151;--wfl-gray-800:#1f2937;--wfl-gray-900:#111827;--wfl-shadow-sm:0 1px 2px 0 rgb(0 0 0 / 0.05);--wfl-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);--wfl-shadow-md:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--wfl-shadow-lg:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--wfl-shadow-xl:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--wfl-radius:12px;--wfl-radius-lg:16px;--wfl-transition:all 0.2s cubic-bezier(0.4, 0, 0.2, 1)}.wfl-container *{box-sizing:border-box;margin:0;padding:0}.wfl-container{font-family:-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Arial,sans-serif;max-width:720px;margin:0 auto;color:var(--wfl-gray-800);line-height:1.5}.wfl-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:32px;flex-wrap:wrap;gap:16px}.wfl-header-content{display:flex;flex-direction:column;gap:4px}.wfl-title{font-size:24px;font-weight:700;color:var(--wfl-gray-900);display:flex;align-items:center;gap:10px}.wfl-title-icon{width:32px;height:32px;background:linear-gradient(135deg,var(--wfl-primary) 0%,#8b5cf6 100%);border-radius:8px;display:flex;align-items:center;justify-content:center}.wfl-title-icon svg{width:18px;height:18px;color:white}.wfl-subtitle{font-size:14px;color:var(--wfl-gray-500)}.wfl-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 18px;font-size:14px;font-weight:600;border-radius:10px;border:none;cursor:pointer;transition:var(--wfl-transition);position:relative;overflow:hidden}.wfl-btn::before{content:\"\";position:absolute;inset:0;background:linear-gradient(135deg,transparent 0%,rgba(255,255,255,0.1) 100%);opacity:0;transition:var(--wfl-transition)}.wfl-btn:hover::before{opacity:1}.wfl-btn-primary{background:linear-gradient(135deg,var(--wfl-primary) 0%,#8b5cf6 100%);color:white;box-shadow:0 4px 14px 0 rgba(99,102,241,0.35)}.wfl-btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px 0 rgba(99,102,241,0.45)}.wfl-btn-primary:active{transform:translateY(0)}.wfl-btn-secondary{background:white;color:var(--wfl-gray-700);border:1px solid var(--wfl-gray-200)}.wfl-btn-secondary:hover{background:var(--wfl-gray-50);border-color:var(--wfl-gray-300)}.wfl-btn svg{width:16px;height:16px}.wfl-btn:disabled{opacity:0.6;cursor:not-allowed;transform:none !important}.wfl-list{display:flex;flex-direction:column;gap:16px}.wfl-card{background:white;border-radius:var(--wfl-radius-lg);border:1px solid var(--wfl-gray-200);padding:16px;display:flex;gap:16px;transition:var(--wfl-transition);position:relative;overflow:hidden;align-items:center}.wfl-card::before{content:\"\";position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--wfl-primary),#8b5cf6,#ec4899);opacity:0;transition:var(--wfl-transition)}.wfl-card:hover{border-color:var(--wfl-gray-300);box-shadow:var(--wfl-shadow-md)}.wfl-card:hover::before{opacity:1}.wfl-vote{display:flex;flex-direction:column;align-items:center;gap:4px;min-width:56px}.wfl-vote-btn{width:40px;height:32px;border-radius:8px;border:1.5px solid var(--wfl-gray-200);background:white;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--wfl-transition);color:var(--wfl-gray-400)}.wfl-vote-btn svg{width:16px;height:16px;transition:var(--wfl-transition)}.wfl-vote-btn:hover{border-color:var(--wfl-primary);color:var(--wfl-primary);background:var(--wfl-primary-light)}.wfl-vote-btn:active{transform:scale(0.92)}.wfl-vote-btn.wfl-voted{background:var(--wfl-primary);border-color:var(--wfl-primary);color:white}.wfl-vote-btn.wfl-voted:hover{background:var(--wfl-primary-hover)}.wfl-vote-btn.wfl-vote-down.wfl-voted{background:var(--wfl-danger);border-color:var(--wfl-danger)}.wfl-vote-btn:disabled{opacity:0.5;cursor:not-allowed}.wfl-vote-count{font-size:18px;font-weight:700;color:var(--wfl-gray-900);min-height:28px;display:flex;align-items:center;transition:var(--wfl-transition)}.wfl-vote-count.wfl-vote-positive{color:var(--wfl-primary)}.wfl-vote-count.wfl-vote-negative{color:var(--wfl-danger)}@keyframes wfl-vote-pop{0%{transform:scale(1)}50%{transform:scale(1.3)}100%{transform:scale(1)}}.wfl-vote-count.wfl-animating{animation:wfl-vote-pop 0.3s ease-out}@keyframes wfl-confetti{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(-20px) rotate(180deg);opacity:0}}.wfl-confetti{position:absolute;width:6px;height:6px;border-radius:50%;animation:wfl-confetti 0.6s ease-out forwards;pointer-events:none}.wfl-content{flex:1;min-width:0}.wfl-content-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:8px}.wfl-feature-title{font-size:16px;font-weight:600;color:var(--wfl-gray-900);cursor:pointer;transition:var(--wfl-transition)}.wfl-feature-title:hover{color:var(--wfl-primary)}.wfl-status{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;border-radius:20px;white-space:nowrap;flex-shrink:0}.wfl-status-dot{width:6px;height:6px;border-radius:50%}.wfl-status-open{background:var(--wfl-primary-light);color:var(--wfl-primary)}.wfl-status-open .wfl-status-dot{background:var(--wfl-primary)}.wfl-status-planned{background:#fef3c7;color:#d97706}.wfl-status-planned .wfl-status-dot{background:var(--wfl-warning)}.wfl-status-progress{background:#d1fae5;color:#059669}.wfl-status-progress .wfl-status-dot{background:var(--wfl-success);animation:wfl-pulse 2s infinite}@keyframes wfl-pulse{0%,100%{opacity:1}50%{opacity:0.5}}.wfl-status-completed{background:#d1fae5;color:#059669}.wfl-status-completed .wfl-status-dot{background:var(--wfl-success)}.wfl-description{font-size:14px;color:var(--wfl-gray-600);line-height:1.6;margin-bottom:12px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.wfl-footer{display:flex;align-items:center;gap:16px}.wfl-meta{display:flex;align-items:center;gap:6px;font-size:13px;color:var(--wfl-gray-500);cursor:pointer;padding:4px 8px;border-radius:6px;transition:var(--wfl-transition);border:1px solid var(--wfl-gray-100)}.wfl-meta:hover{background:var(--wfl-gray-100);color:var(--wfl-gray-700)}.wfl-meta svg{width:14px;height:14px}.wfl-tag{display:inline-flex;align-items:center;padding:3px 8px;font-size:11px;font-weight:500;background:var(--wfl-gray-100);color:var(--wfl-gray-600);border-radius:5px}.wfl-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:99999;opacity:0;visibility:hidden;transition:var(--wfl-transition);padding:20px}.wfl-modal-overlay.wfl-active{opacity:1;visibility:visible}.wfl-modal{background:white;border-radius:var(--wfl-radius-lg);width:100%;max-width:520px;max-height:90vh;overflow:hidden;transform:scale(0.9) translateY(20px);transition:var(--wfl-transition);box-shadow:var(--wfl-shadow-xl)}.wfl-modal-overlay.wfl-active .wfl-modal{transform:scale(1) translateY(0)}.wfl-modal-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid var(--wfl-gray-200)}.wfl-modal-title{font-size:18px;font-weight:600;color:var(--wfl-gray-900)}.wfl-modal-close{width:32px;height:32px;border-radius:8px;border:none;background:transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--wfl-gray-500);transition:var(--wfl-transition)}.wfl-modal-close:hover{background:var(--wfl-gray-100);color:var(--wfl-gray-700)}.wfl-modal-close svg{width:20px;height:20px}.wfl-modal-body{padding:24px;overflow-y:auto;max-height:calc(90vh - 140px)}.wfl-form-group{margin-bottom:20px}.wfl-label{display:block;font-size:14px;font-weight:500;color:var(--wfl-gray-700);margin-bottom:8px}.wfl-input,.wfl-textarea,input.wfl-input{width:100%;padding:12px 14px;font-size:14px;border:1.5px solid var(--wfl-gray-200);border-radius:10px;background:white;color:var(--wfl-gray-800);transition:var(--wfl-transition);font-family:inherit}.wfl-input:focus,.wfl-textarea:focus{outline:none;border-color:var(--wfl-primary);box-shadow:0 0 0 3px rgba(99,102,241,0.1)}.wfl-input::placeholder,.wfl-textarea::placeholder{color:var(--wfl-gray-400)}.wfl-textarea{resize:vertical;min-height:100px}.wfl-modal-footer{display:flex;justify-content:flex-end;gap:12px;padding:16px 24px;border-top:1px solid var(--wfl-gray-200);background:var(--wfl-gray-50)}.wfl-comments-section{margin-top:16px;padding-top:16px;border-top:1px solid var(--wfl-gray-200)}.wfl-comments-list{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}.wfl-comment{display:flex;gap:12px}.wfl-comment-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--wfl-primary) 0%,#8b5cf6 100%);display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:600;flex-shrink:0}.wfl-comment-content{flex:1;background:var(--wfl-gray-50);padding:10px 14px;border-radius:10px}.wfl-comment-header{display:flex;align-items:center;gap:8px;margin-bottom:4px}.wfl-comment-author{font-size:13px;font-weight:600;color:var(--wfl-gray-800)}.wfl-comment-time{font-size:12px;color:var(--wfl-gray-400)}.wfl-comment-text{font-size:14px;color:var(--wfl-gray-600);line-height:1.5}.wfl-comment-input-wrapper{display:flex;gap:12px}.wfl-comment-input{flex:1;padding:10px 14px;font-size:14px;border:1.5px solid var(--wfl-gray-200);border-radius:10px;background:white;color:var(--wfl-gray-800);transition:var(--wfl-transition);font-family:inherit}.wfl-comment-input:focus{outline:none;border-color:var(--wfl-primary);box-shadow:0 0 0 3px rgba(99,102,241,0.1)}.wfl-comment-submit{width:40px;height:40px;border-radius:10px;border:none;background:var(--wfl-primary);color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--wfl-transition)}.wfl-comment-submit:hover{background:var(--wfl-primary-hover);transform:scale(1.05)}.wfl-comment-submit:active{transform:scale(0.95)}.wfl-comment-submit svg{width:18px;height:18px}.wfl-empty{text-align:center;padding:48px 24px}.wfl-empty-icon{width:64px;height:64px;background:var(--wfl-gray-100);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px}.wfl-empty-icon svg{width:28px;height:28px;color:var(--wfl-gray-400)}.wfl-empty-title{font-size:16px;font-weight:600;color:var(--wfl-gray-800);margin-bottom:4px}.wfl-empty-text{font-size:14px;color:var(--wfl-gray-500)}.wfl-toast{position:fixed;bottom:24px;right:24px;padding:14px 20px;background:var(--wfl-gray-900);color:white;font-size:14px;font-weight:500;border-radius:10px;box-shadow:var(--wfl-shadow-lg);z-index:999999;transform:translateY(100px);opacity:0;transition:var(--wfl-transition)}.wfl-toast.wfl-active{transform:translateY(0);opacity:1}.wfl-toast-success{background:var(--wfl-success)}.wfl-toast-error{background:var(--wfl-danger)}.wfl-skeleton{background:linear-gradient(90deg,var(--wfl-gray-200) 25%,var(--wfl-gray-100) 50%,var(--wfl-gray-200) 75%);background-size:200% 100%;animation:wfl-shimmer 1.5s infinite;border-radius:6px}@keyframes wfl-shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}.wfl-skeleton-card{background:white;border-radius:var(--wfl-radius-lg);border:1px solid var(--wfl-gray-200);padding:16px;display:flex;gap:16px;align-items:center}.wfl-skeleton-vote{display:flex;flex-direction:column;align-items:center;gap:8px;min-width:56px}.wfl-skeleton-vote-btn{width:40px;height:32px}.wfl-skeleton-vote-count{width:24px;height:20px}.wfl-skeleton-content{flex:1}.wfl-skeleton-title{height:20px;width:60%;margin-bottom:12px}.wfl-skeleton-desc{height:14px;width:90%;margin-bottom:8px}.wfl-skeleton-desc-2{height:14px;width:70%;margin-bottom:16px}.wfl-skeleton-footer{display:flex;gap:12px}.wfl-skeleton-meta{height:24px;width:80px}.wfl-skeleton-tag{height:20px;width:50px}@media (max-width:600px){.wfl-container{padding:16px}.wfl-header{flex-direction:column;align-items:stretch}.wfl-card{flex-direction:column;align-items:stretch}.wfl-vote{flex-direction:row;justify-content:flex-start}.wfl-modal{max-width:100%;margin:16px}.wfl-skeleton-card{flex-direction:column;align-items:stretch}.wfl-skeleton-vote{flex-direction:row;justify-content:flex-start}}.wfl-ripple{position:relative;overflow:hidden}.wfl-ripple::after{content:\"\";position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none;background-image:radial-gradient(circle,rgba(255,255,255,0.3) 10%,transparent 10.01%);background-repeat:no-repeat;background-position:50%;transform:scale(10,10);opacity:0;transition:transform 0.5s,opacity 1s}.wfl-ripple:active::after{transform:scale(0,0);opacity:0.3;transition:0s}.wfl-tooltip{position:relative}.wfl-tooltip::after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%) translateY(-4px);padding:6px 10px;background:var(--wfl-gray-900);color:white;font-size:12px;font-weight:500;border-radius:6px;white-space:nowrap;opacity:0;visibility:hidden;transition:var(--wfl-transition);pointer-events:none}.wfl-tooltip:hover::after{opacity:1;visibility:visible;transform:translateX(-50%) translateY(-8px)}.wfl-btn:focus-visible,.wfl-vote-btn:focus-visible,.wfl-input:focus-visible,.wfl-textarea:focus-visible{outline:2px solid var(--wfl-primary);outline-offset:2px}.wfl-error{text-align:center;padding:48px 24px;color:var(--wfl-danger)}.wfl-error-icon{width:64px;height:64px;background:#fef2f2;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px}.wfl-error-icon svg{width:28px;height:28px;color:var(--wfl-danger)}.wfl-error-title{font-size:16px;font-weight:600;margin-bottom:4px}.wfl-error-text{font-size:14px;color:var(--wfl-gray-500);margin-bottom:16px}`;\n\n  /**\n   * Inject styles into the document head\n   */\n  function injectStyles() {\n    if (typeof document === \"undefined\") return;\n    if (document.getElementById(\"wpfeatureloop-styles\")) return;\n\n    const styleElement = document.createElement(\"style\");\n    styleElement.id = \"wpfeatureloop-styles\";\n    styleElement.textContent = styles;\n    document.head.appendChild(styleElement);\n  }\n\n  // Auto-inject styles when module loads\n  injectStyles();\n\n  /**\n   * SVG Icons\n   */\n  const icons = {\n    plus: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 5v14M5 12h14\"/></svg>',\n    arrowUp:\n      '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m18 15-6-6-6 6\"/></svg>',\n    arrowDown:\n      '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m6 9 6 6 6-6\"/></svg>',\n    comment:\n      '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"/></svg>',\n    close:\n      '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M18 6 6 18M6 6l12 12\"/></svg>',\n    send: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m22 2-7 20-4-9-9-4 20-7z\"/><path d=\"m22 2-11 11\"/></svg>',\n    empty:\n      '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\"/></svg>',\n    error:\n      '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"m15 9-6 6M9 9l6 6\"/></svg>',\n  };\n\n  /**\n   * Translations\n   */\n  const translations = {\n    en: {\n      title: \"Feature Roadmap\",\n      subtitle: \"Vote for features you want to see next\",\n      suggestFeature: \"Suggest Feature\",\n      suggestTitle: \"Suggest a Feature\",\n      titleLabel: \"Title\",\n      titlePlaceholder: \"Brief description of your feature idea\",\n      descriptionLabel: \"Description\",\n      descriptionPlaceholder:\n        \"Explain the feature and why it would be valuable...\",\n      categoryLabel: \"Category\",\n      categoryPlaceholder: \"e.g., UI/UX, Performance, Integration\",\n      cancel: \"Cancel\",\n      submit: \"Submit Feature\",\n      comments: \"comments\",\n      comment: \"comment\",\n      addComment: \"Add a comment...\",\n      noComments: \"No comments yet. Be the first to share your thoughts!\",\n      emptyTitle: \"No features yet\",\n      emptyText: \"Be the first to suggest a feature!\",\n      errorTitle: \"Failed to load features\",\n      errorText: \"Please try again later.\",\n      retry: \"Retry\",\n      fillAllFields: \"Please fill in all fields\",\n      featureSubmitted: \"Feature submitted successfully!\",\n      commentAdded: \"Comment added!\",\n      voteSaved: \"Vote saved!\",\n      statusOpen: \"Open\",\n      statusPlanned: \"Planned\",\n      statusProgress: \"In Progress\",\n      statusCompleted: \"Completed\",\n      upvote: \"Upvote\",\n      downvote: \"Downvote\",\n    },\n    \"pt-BR\": {\n      title: \"Roadmap de Features\",\n      subtitle: \"Vote nas funcionalidades que deseja ver\",\n      suggestFeature: \"Sugerir Feature\",\n      suggestTitle: \"Sugerir uma Feature\",\n      titleLabel: \"Título\",\n      titlePlaceholder: \"Breve descrição da sua ideia\",\n      descriptionLabel: \"Descrição\",\n      descriptionPlaceholder: \"Explique a feature e por que seria valiosa...\",\n      categoryLabel: \"Categoria\",\n      categoryPlaceholder: \"Ex: UI/UX, Performance, Integração\",\n      cancel: \"Cancelar\",\n      submit: \"Enviar Feature\",\n      comments: \"comentários\",\n      comment: \"comentário\",\n      addComment: \"Adicionar um comentário...\",\n      noComments: \"Nenhum comentário ainda. Seja o primeiro!\",\n      emptyTitle: \"Nenhuma feature ainda\",\n      emptyText: \"Seja o primeiro a sugerir uma feature!\",\n      errorTitle: \"Erro ao carregar features\",\n      errorText: \"Por favor, tente novamente mais tarde.\",\n      retry: \"Tentar novamente\",\n      fillAllFields: \"Por favor, preencha todos os campos\",\n      featureSubmitted: \"Feature enviada com sucesso!\",\n      commentAdded: \"Comentário adicionado!\",\n      voteSaved: \"Voto salvo!\",\n      statusOpen: \"Aberto\",\n      statusPlanned: \"Planejado\",\n      statusProgress: \"Em Progresso\",\n      statusCompleted: \"Concluído\",\n      upvote: \"Votar a favor\",\n      downvote: \"Votar contra\",\n    },\n  };\n\n  /**\n   * API Service\n   * Handles all API communication\n   */\n  class ApiService {\n    constructor(config) {\n      this.publicKey = config.publicKey;\n      this.projectId = config.projectId;\n      this.user = config.user;\n      this.signature = config.signature;\n      this.baseUrl = config.apiUrl || \"https://app.wpfeatureloop.com/api/v1\";\n    }\n\n    /**\n     * Get headers for API requests\n     */\n    _getHeaders() {\n      return {\n        \"Content-Type\": \"application/json\",\n        \"X-Public-Key\": this.publicKey,\n        \"X-Project-Id\": this.projectId,\n        \"X-User-Id\": this.user?.id?.toString() || \"\",\n        \"X-User-Name\": this.user?.name || \"\",\n        \"X-Signature\": this.signature || \"\",\n      };\n    }\n\n    /**\n     * Handle API response\n     */\n    async _handleResponse(response) {\n      if (!response.ok) {\n        const data = await response.json().catch(() => ({}));\n        const error = new Error(data.error || `HTTP error ${response.status}`);\n        error.status = response.status;\n        error.data = data;\n        throw error;\n      }\n      return response.json();\n    }\n\n    /**\n     * Fetch features list\n     * @returns {Promise<Array>}\n     */\n    async getFeatures() {\n      const response = await fetch(`${this.baseUrl}/features`, {\n        method: \"GET\",\n        headers: this._getHeaders(),\n      });\n      return this._handleResponse(response);\n    }\n\n    /**\n     * Vote on a feature\n     * @param {string} featureId\n     * @param {string} voteType - 'up', 'down', or 'none'\n     * @returns {Promise<Object>}\n     */\n    async vote(featureId, voteType) {\n      const response = await fetch(\n        `${this.baseUrl}/features/${featureId}/vote`,\n        {\n          method: \"POST\",\n          headers: this._getHeaders(),\n          body: JSON.stringify({ vote: voteType }),\n        },\n      );\n      return this._handleResponse(response);\n    }\n\n    /**\n     * Get comments for a feature\n     * @param {string} featureId\n     * @returns {Promise<Array>}\n     */\n    async getComments(featureId) {\n      const response = await fetch(\n        `${this.baseUrl}/features/${featureId}/comments`,\n        {\n          method: \"GET\",\n          headers: this._getHeaders(),\n        },\n      );\n      return this._handleResponse(response);\n    }\n\n    /**\n     * Add a comment to a feature\n     * @param {string} featureId\n     * @param {string} text\n     * @returns {Promise<Object>}\n     */\n    async addComment(featureId, text) {\n      const response = await fetch(\n        `${this.baseUrl}/features/${featureId}/comments`,\n        {\n          method: \"POST\",\n          headers: this._getHeaders(),\n          body: JSON.stringify({ text }),\n        },\n      );\n      return this._handleResponse(response);\n    }\n\n    /**\n     * Create a new feature suggestion\n     * @param {Object} feature\n     * @returns {Promise<Object>}\n     */\n    async createFeature(feature) {\n      const response = await fetch(`${this.baseUrl}/features`, {\n        method: \"POST\",\n        headers: this._getHeaders(),\n        body: JSON.stringify({\n          title: feature.title,\n          description: feature.description,\n        }),\n      });\n      return this._handleResponse(response);\n    }\n  }\n\n  /**\n   * WPFeatureLoop Main Class\n   */\n  class WPFeatureLoop {\n    /**\n     * @param {Object} config\n     * @param {string} config.container - CSS selector for the container element\n     * @param {string} config.publicKey - Public API key\n     * @param {string} config.projectId - Project ID\n     * @param {string} [config.locale='en'] - Locale for translations\n     * @param {Object} [config.user] - User data\n     * @param {number|string} config.user.id - User ID (required)\n     * @param {string} [config.user.email] - User email\n     * @param {string} [config.user.name] - User display name\n     * @param {string} [config.user.plan] - User plan (free, pro, etc)\n     * @param {Object} [config.user.meta] - Additional user metadata\n     * @param {string} [config.signature] - HMAC signature for user data\n     * @param {Array<string>} [config.allowedRoles] - Roles allowed to create features\n     * @param {string} [config.userRole] - Current user's role\n     * @param {string} [config.apiUrl] - Custom API URL\n     */\n    constructor(config) {\n      this.config = config;\n      this.container = null;\n      this.features = [];\n      this.isLoading = true;\n      this.hasError = false;\n      this.currentCommentFeatureId = null;\n      this.currentComments = [];\n\n      // Validate required config\n      if (!config.container) {\n        throw new Error(\"WPFeatureLoop: container is required\");\n      }\n      if (!config.publicKey) {\n        throw new Error(\"WPFeatureLoop: publicKey is required\");\n      }\n      if (!config.projectId) {\n        throw new Error(\"WPFeatureLoop: projectId is required\");\n      }\n      if (!config.user?.id) {\n        throw new Error(\"WPFeatureLoop: user.id is required\");\n      }\n\n      // Set defaults\n      this.locale = config.locale || \"en\";\n      this.t = translations[this.locale] || translations[\"en\"];\n      this.allowedRoles = config.allowedRoles || [\"administrator\"];\n      this.userRole = config.userRole || \"subscriber\";\n\n      // Initialize API service\n      this.api = new ApiService(config);\n    }\n\n    /**\n     * Check if current user can create features\n     */\n    canCreateFeature() {\n      return this.allowedRoles.includes(this.userRole);\n    }\n\n    /**\n     * Initialize the widget\n     */\n    async init() {\n      this.container = document.querySelector(this.config.container);\n\n      if (!this.container) {\n        throw new Error(\n          `WPFeatureLoop: Container \"${this.config.container}\" not found`,\n        );\n      }\n\n      this.container.classList.add(\"wfl-container\");\n      this.renderSkeleton();\n\n      try {\n        this.features = await this.api.getFeatures();\n        this.isLoading = false;\n        this.render();\n      } catch (error) {\n        console.error(\"WPFeatureLoop: Failed to load features\", error);\n        this.isLoading = false;\n        this.hasError = true;\n        this.renderError();\n      }\n    }\n\n    /**\n     * Render skeleton loading state\n     */\n    renderSkeleton() {\n      const skeletonCards = Array(3)\n        .fill(0)\n        .map(\n          () => `\n        <div class=\"wfl-skeleton-card\">\n          <div class=\"wfl-skeleton-vote\">\n            <div class=\"wfl-skeleton wfl-skeleton-vote-btn\"></div>\n            <div class=\"wfl-skeleton wfl-skeleton-vote-count\"></div>\n            <div class=\"wfl-skeleton wfl-skeleton-vote-btn\"></div>\n          </div>\n          <div class=\"wfl-skeleton-content\">\n            <div class=\"wfl-skeleton wfl-skeleton-title\"></div>\n            <div class=\"wfl-skeleton wfl-skeleton-desc\"></div>\n            <div class=\"wfl-skeleton wfl-skeleton-desc-2\"></div>\n            <div class=\"wfl-skeleton-footer\">\n              <div class=\"wfl-skeleton wfl-skeleton-meta\"></div>\n              <div class=\"wfl-skeleton wfl-skeleton-tag\"></div>\n            </div>\n          </div>\n        </div>\n      `,\n        )\n        .join(\"\");\n\n      this.container.innerHTML = `\n        <div class=\"wfl-header\">\n          <div class=\"wfl-header-content\">\n            <h1 class=\"wfl-title\">${this.t.title}</h1>\n            <p class=\"wfl-subtitle\">${this.t.subtitle}</p>\n          </div>\n          ${\n            this.canCreateFeature()\n              ? `\n            <button class=\"wfl-btn wfl-btn-primary wfl-ripple\" disabled>\n              ${icons.plus}\n              ${this.t.suggestFeature}\n            </button>\n          `\n              : \"\"\n          }\n        </div>\n        <div class=\"wfl-list\">\n          ${skeletonCards}\n        </div>\n      `;\n    }\n\n    /**\n     * Render error state\n     */\n    renderError() {\n      this.container.innerHTML = `\n        <div class=\"wfl-header\">\n          <div class=\"wfl-header-content\">\n            <h1 class=\"wfl-title\">${this.t.title}</h1>\n            <p class=\"wfl-subtitle\">${this.t.subtitle}</p>\n          </div>\n        </div>\n        <div class=\"wfl-error\">\n          <div class=\"wfl-error-icon\">${icons.error}</div>\n          <h3 class=\"wfl-error-title\">${this.t.errorTitle}</h3>\n          <p class=\"wfl-error-text\">${this.t.errorText}</p>\n          <button class=\"wfl-btn wfl-btn-primary\" id=\"wfl-retry\">\n            ${this.t.retry}\n          </button>\n        </div>\n      `;\n\n      this.container\n        .querySelector(\"#wfl-retry\")\n        ?.addEventListener(\"click\", () => {\n          this.hasError = false;\n          this.isLoading = true;\n          this.init();\n        });\n    }\n\n    /**\n     * Main render method\n     */\n    render() {\n      const featuresHtml =\n        this.features.length > 0\n          ? this.features.map((f) => this.renderCard(f)).join(\"\")\n          : this.renderEmpty();\n\n      this.container.innerHTML = `\n        <div class=\"wfl-header\">\n          <div class=\"wfl-header-content\">\n            <h1 class=\"wfl-title\">${this.t.title}</h1>\n            <p class=\"wfl-subtitle\">${this.t.subtitle}</p>\n          </div>\n          ${\n            this.canCreateFeature()\n              ? `\n            <button class=\"wfl-btn wfl-btn-primary wfl-ripple\" id=\"wfl-add-feature\">\n              ${icons.plus}\n              ${this.t.suggestFeature}\n            </button>\n          `\n              : \"\"\n          }\n        </div>\n        <div class=\"wfl-list\" id=\"wfl-list\">\n          ${featuresHtml}\n        </div>\n        ${this.renderModal()}\n        ${this.renderCommentModal()}\n        <div class=\"wfl-toast\" id=\"wfl-toast\"></div>\n      `;\n\n      this.attachEventListeners();\n    }\n\n    /**\n     * Render a feature card\n     */\n    renderCard(feature) {\n      const voteClass =\n        feature.votes > 0\n          ? \"wfl-vote-positive\"\n          : feature.votes < 0\n            ? \"wfl-vote-negative\"\n            : \"\";\n      const upVoted = feature.userVote === \"up\";\n      const downVoted = feature.userVote === \"down\";\n      const commentText =\n        feature.commentsCount === 1 ? this.t.comment : this.t.comments;\n\n      return `\n        <div class=\"wfl-card\" data-id=\"${feature.id}\">\n          <div class=\"wfl-vote\">\n            <button class=\"wfl-vote-btn wfl-vote-up wfl-tooltip ${upVoted ? \"wfl-voted\" : \"\"}\"\n                    data-id=\"${feature.id}\"\n                    data-action=\"up\"\n                    data-tooltip=\"${this.t.upvote}\">\n              ${icons.arrowUp}\n            </button>\n            <span class=\"wfl-vote-count ${voteClass}\" data-id=\"${feature.id}\">${feature.votes}</span>\n            <button class=\"wfl-vote-btn wfl-vote-down wfl-tooltip ${downVoted ? \"wfl-voted\" : \"\"}\"\n                    data-id=\"${feature.id}\"\n                    data-action=\"down\"\n                    data-tooltip=\"${this.t.downvote}\">\n              ${icons.arrowDown}\n            </button>\n          </div>\n          <div class=\"wfl-content\">\n            <div class=\"wfl-content-header\">\n              <h3 class=\"wfl-feature-title\" data-id=\"${feature.id}\">${feature.title}</h3>\n              ${this.renderStatus(feature.status)}\n            </div>\n            <p class=\"wfl-description\">${feature.description}</p>\n            <div class=\"wfl-footer\">\n              <button class=\"wfl-meta wfl-comment-trigger\" data-id=\"${feature.id}\">\n                ${icons.comment}\n                <span>${feature.commentsCount} ${commentText}</span>\n              </button>\n              ${(feature.tags || []).map((tag) => `<span class=\"wfl-tag\">${tag}</span>`).join(\"\")}\n            </div>\n          </div>\n        </div>\n      `;\n    }\n\n    /**\n     * Render status badge\n     */\n    renderStatus(status) {\n      const labels = {\n        open: this.t.statusOpen,\n        planned: this.t.statusPlanned,\n        progress: this.t.statusProgress,\n        completed: this.t.statusCompleted,\n      };\n\n      return `\n        <span class=\"wfl-status wfl-status-${status}\">\n          <span class=\"wfl-status-dot\"></span>\n          ${labels[status] || status}\n        </span>\n      `;\n    }\n\n    /**\n     * Render empty state\n     */\n    renderEmpty() {\n      return `\n        <div class=\"wfl-empty\">\n          <div class=\"wfl-empty-icon\">${icons.empty}</div>\n          <h3 class=\"wfl-empty-title\">${this.t.emptyTitle}</h3>\n          <p class=\"wfl-empty-text\">${this.t.emptyText}</p>\n        </div>\n      `;\n    }\n\n    /**\n     * Render feature creation modal\n     */\n    renderModal() {\n      if (!this.canCreateFeature()) return \"\";\n\n      return `\n        <div class=\"wfl-modal-overlay\" id=\"wfl-modal\">\n          <div class=\"wfl-modal\">\n            <div class=\"wfl-modal-header\">\n              <h2 class=\"wfl-modal-title\">${this.t.suggestTitle}</h2>\n              <button class=\"wfl-modal-close\" id=\"wfl-modal-close\">\n                ${icons.close}\n              </button>\n            </div>\n            <div class=\"wfl-modal-body\">\n              <div class=\"wfl-form-group\">\n                <label class=\"wfl-label\" for=\"wfl-feature-title\">${this.t.titleLabel}</label>\n                <input type=\"text\" class=\"wfl-input\" id=\"wfl-feature-title\" placeholder=\"${this.t.titlePlaceholder}\">\n              </div>\n              <div class=\"wfl-form-group\">\n                <label class=\"wfl-label\" for=\"wfl-feature-desc\">${this.t.descriptionLabel}</label>\n                <textarea class=\"wfl-textarea\" id=\"wfl-feature-desc\" placeholder=\"${this.t.descriptionPlaceholder}\"></textarea>\n              </div>\n            </div>\n            <div class=\"wfl-modal-footer\">\n              <button class=\"wfl-btn wfl-btn-secondary\" id=\"wfl-modal-cancel\">${this.t.cancel}</button>\n              <button class=\"wfl-btn wfl-btn-primary wfl-ripple\" id=\"wfl-modal-submit\">${this.t.submit}</button>\n            </div>\n          </div>\n        </div>\n      `;\n    }\n\n    /**\n     * Render comments modal\n     */\n    renderCommentModal() {\n      return `\n        <div class=\"wfl-modal-overlay\" id=\"wfl-comment-modal\">\n          <div class=\"wfl-modal\">\n            <div class=\"wfl-modal-header\">\n              <h2 class=\"wfl-modal-title\" id=\"wfl-comment-title\">${this.t.comments}</h2>\n              <button class=\"wfl-modal-close\" id=\"wfl-comment-modal-close\">\n                ${icons.close}\n              </button>\n            </div>\n            <div class=\"wfl-modal-body\">\n              <div class=\"wfl-comments-list\" id=\"wfl-comments-list\"></div>\n              <div class=\"wfl-comment-input-wrapper\">\n                <input type=\"text\" class=\"wfl-comment-input\" id=\"wfl-comment-input\" placeholder=\"${this.t.addComment}\">\n                <button class=\"wfl-comment-submit\" id=\"wfl-comment-submit\">\n                  ${icons.send}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      `;\n    }\n\n    /**\n     * Render comments list\n     */\n    renderCommentsList(comments) {\n      if (comments.length === 0) {\n        return `<p style=\"text-align: center; color: var(--wfl-gray-500); padding: 20px;\">${this.t.noComments}</p>`;\n      }\n\n      return comments\n        .map(\n          (c) => `\n        <div class=\"wfl-comment${c.isTeamReply ? ' wfl-comment-team' : ''}\">\n          <div class=\"wfl-comment-avatar${c.isTeamReply ? ' wfl-comment-avatar-team' : ''}\">${c.initials}</div>\n          <div class=\"wfl-comment-content${c.isTeamReply ? ' wfl-comment-content-team' : ''}\">\n            <div class=\"wfl-comment-header\">\n              <span class=\"wfl-comment-author\">${c.author}</span>\n              ${c.isTeamReply ? '<span class=\"wfl-comment-team-badge\">Team</span>' : ''}\n              <span class=\"wfl-comment-time\">${c.time}</span>\n            </div>\n            <p class=\"wfl-comment-text\">${c.text}</p>\n          </div>\n        </div>\n      `,\n        )\n        .join(\"\");\n    }\n\n    /**\n     * Attach event listeners\n     */\n    attachEventListeners() {\n      // Add feature button\n      const addBtn = this.container.querySelector(\"#wfl-add-feature\");\n      if (addBtn) {\n        addBtn.addEventListener(\"click\", () => this.openModal());\n      }\n\n      // Modal events\n      const modal = this.container.querySelector(\"#wfl-modal\");\n      if (modal) {\n        const modalClose = this.container.querySelector(\"#wfl-modal-close\");\n        const modalCancel = this.container.querySelector(\"#wfl-modal-cancel\");\n        const modalSubmit = this.container.querySelector(\"#wfl-modal-submit\");\n\n        modalClose?.addEventListener(\"click\", () => this.closeModal());\n        modalCancel?.addEventListener(\"click\", () => this.closeModal());\n        modal.addEventListener(\"click\", (e) => {\n          if (e.target === modal) this.closeModal();\n        });\n        modalSubmit?.addEventListener(\"click\", () =>\n          this.handleSubmitFeature(),\n        );\n      }\n\n      // Comment modal events\n      const commentModal = this.container.querySelector(\"#wfl-comment-modal\");\n      if (commentModal) {\n        const commentClose = this.container.querySelector(\n          \"#wfl-comment-modal-close\",\n        );\n\n        commentClose?.addEventListener(\"click\", () => this.closeCommentModal());\n        commentModal.addEventListener(\"click\", (e) => {\n          if (e.target === commentModal) this.closeCommentModal();\n        });\n      }\n\n      // Card events\n      this.features.forEach((f) => this.attachCardListeners(f.id));\n    }\n\n    /**\n     * Attach listeners to a specific card\n     */\n    attachCardListeners(featureId) {\n      const card = this.container.querySelector(\n        `.wfl-card[data-id=\"${featureId}\"]`,\n      );\n      if (!card) return;\n\n      // Vote buttons\n      card.querySelectorAll(\".wfl-vote-btn\").forEach((btn) => {\n        btn.addEventListener(\"click\", (e) => {\n          e.stopPropagation();\n          this.handleVote(btn);\n        });\n      });\n\n      // Comment trigger\n      const commentTrigger = card.querySelector(\".wfl-comment-trigger\");\n      if (commentTrigger) {\n        commentTrigger.addEventListener(\"click\", () => {\n          this.openCommentModal(featureId);\n        });\n      }\n    }\n\n    /**\n     * Open feature creation modal\n     */\n    openModal() {\n      const modal = this.container.querySelector(\"#wfl-modal\");\n      if (modal) {\n        modal.classList.add(\"wfl-active\");\n      }\n    }\n\n    /**\n     * Close feature creation modal\n     */\n    closeModal() {\n      const modal = this.container.querySelector(\"#wfl-modal\");\n      if (modal) {\n        modal.classList.remove(\"wfl-active\");\n        this.container.querySelector(\"#wfl-feature-title\").value = \"\";\n        this.container.querySelector(\"#wfl-feature-desc\").value = \"\";\n      }\n    }\n\n    /**\n     * Handle feature submission\n     */\n    async handleSubmitFeature() {\n      const title = this.container\n        .querySelector(\"#wfl-feature-title\")\n        .value.trim();\n      const description = this.container\n        .querySelector(\"#wfl-feature-desc\")\n        .value.trim();\n\n      if (!title || !description) {\n        this.showToast(this.t.fillAllFields, \"error\");\n        return;\n      }\n\n      const submitBtn = this.container.querySelector(\"#wfl-modal-submit\");\n      submitBtn.disabled = true;\n\n      try {\n        const newFeature = await this.api.createFeature({\n          title,\n          description,\n        });\n        this.features.unshift(newFeature);\n\n        const list = this.container.querySelector(\"#wfl-list\");\n        list.insertAdjacentHTML(\"afterbegin\", this.renderCard(newFeature));\n        this.attachCardListeners(newFeature.id);\n\n        this.closeModal();\n        this.showToast(this.t.featureSubmitted, \"success\");\n      } catch (error) {\n        console.error(\"WPFeatureLoop: Failed to create feature\", error);\n        this.showToast(this.t.errorText, \"error\");\n      } finally {\n        submitBtn.disabled = false;\n      }\n    }\n\n    /**\n     * Open comments modal\n     */\n    async openCommentModal(featureId) {\n      const feature = this.features.find((f) => f.id === featureId);\n      if (!feature) return;\n\n      this.currentCommentFeatureId = featureId;\n      const commentModal = this.container.querySelector(\"#wfl-comment-modal\");\n      const commentsList = this.container.querySelector(\"#wfl-comments-list\");\n      const commentTitle = this.container.querySelector(\"#wfl-comment-title\");\n      const commentInput = this.container.querySelector(\"#wfl-comment-input\");\n\n      // Clear input and show modal\n      commentInput.value = \"\";\n      commentTitle.textContent = feature.title;\n      commentsList.innerHTML =\n        '<div class=\"wfl-skeleton\" style=\"height: 60px; margin-bottom: 12px;\"></div>'.repeat(\n          2,\n        );\n      commentModal.classList.add(\"wfl-active\");\n\n      try {\n        this.currentComments = await this.api.getComments(featureId);\n        commentsList.innerHTML = this.renderCommentsList(this.currentComments);\n\n        // Create submit handler that reads input value at call time\n        const self = this;\n        const handleSubmit = async () => {\n          // Get fresh reference to input element\n          const input = self.container.querySelector(\"#wfl-comment-input\");\n          const submitBtn = self.container.querySelector(\"#wfl-comment-submit\");\n          const text = input.value.trim();\n\n          if (!text) return;\n\n          submitBtn.disabled = true;\n\n          try {\n            const newComment = await self.api.addComment(featureId, text);\n            self.currentComments.push(newComment);\n            commentsList.innerHTML = self.renderCommentsList(\n              self.currentComments,\n            );\n\n            // Update comment count on card\n            feature.commentsCount = self.currentComments.length;\n            const card = self.container.querySelector(\n              `.wfl-card[data-id=\"${featureId}\"]`,\n            );\n            const commentTrigger = card?.querySelector(\n              \".wfl-comment-trigger span\",\n            );\n            if (commentTrigger) {\n              const commentText =\n                feature.commentsCount === 1 ? self.t.comment : self.t.comments;\n              commentTrigger.textContent = `${feature.commentsCount} ${commentText}`;\n            }\n\n            input.value = \"\";\n            self.showToast(self.t.commentAdded, \"success\");\n          } catch (error) {\n            console.error(\"WPFeatureLoop: Failed to add comment\", error);\n            self.showToast(self.t.errorText, \"error\");\n          } finally {\n            submitBtn.disabled = false;\n          }\n        };\n\n        // Attach listeners (replace elements to remove old listeners)\n        const oldSubmit = this.container.querySelector(\"#wfl-comment-submit\");\n        const oldInput = this.container.querySelector(\"#wfl-comment-input\");\n\n        const newSubmit = oldSubmit.cloneNode(true);\n        oldSubmit.parentNode.replaceChild(newSubmit, oldSubmit);\n        newSubmit.addEventListener(\"click\", handleSubmit);\n\n        const newInput = oldInput.cloneNode(true);\n        oldInput.parentNode.replaceChild(newInput, oldInput);\n        newInput.addEventListener(\"keypress\", (e) => {\n          if (e.key === \"Enter\") handleSubmit();\n        });\n      } catch (error) {\n        console.error(\"WPFeatureLoop: Failed to load comments\", error);\n        commentsList.innerHTML = `<p style=\"text-align: center; color: var(--wfl-danger);\">${this.t.errorText}</p>`;\n      }\n    }\n\n    /**\n     * Close comments modal\n     */\n    closeCommentModal() {\n      const commentModal = this.container.querySelector(\"#wfl-comment-modal\");\n      if (commentModal) {\n        commentModal.classList.remove(\"wfl-active\");\n\n        // Clear input\n        const commentInput = this.container.querySelector(\"#wfl-comment-input\");\n        if (commentInput) {\n          commentInput.value = \"\";\n        }\n\n        this.currentCommentFeatureId = null;\n        this.currentComments = [];\n      }\n    }\n\n    /**\n     * Handle vote\n     */\n    async handleVote(btn) {\n      const id = btn.dataset.id;\n      const action = btn.dataset.action;\n      const feature = this.features.find((f) => String(f.id) === String(id));\n\n      if (!feature) return;\n\n      const card = this.container.querySelector(`.wfl-card[data-id=\"${id}\"]`);\n      const voteCount = card.querySelector(\".wfl-vote-count\");\n      const upBtn = card.querySelector(\".wfl-vote-up\");\n      const downBtn = card.querySelector(\".wfl-vote-down\");\n\n      // Disable buttons during request\n      upBtn.disabled = true;\n      downBtn.disabled = true;\n\n      // Store original values for rollback\n      const originalVotes = feature.votes;\n      const originalUserVote = feature.userVote;\n\n      // Calculate new vote state\n      let newVoteType = \"none\";\n      let voteDelta = 0;\n\n      if (action === \"up\") {\n        if (feature.userVote === \"up\") {\n          voteDelta = -1;\n          newVoteType = \"none\";\n        } else if (feature.userVote === \"down\") {\n          voteDelta = 2;\n          newVoteType = \"up\";\n        } else {\n          voteDelta = 1;\n          newVoteType = \"up\";\n        }\n      } else {\n        if (feature.userVote === \"down\") {\n          voteDelta = 1;\n          newVoteType = \"none\";\n        } else if (feature.userVote === \"up\") {\n          voteDelta = -2;\n          newVoteType = \"down\";\n        } else {\n          voteDelta = -1;\n          newVoteType = \"down\";\n        }\n      }\n\n      // Optimistic update\n      feature.votes += voteDelta;\n      feature.userVote = newVoteType === \"none\" ? null : newVoteType;\n\n      // Update UI\n      upBtn.classList.toggle(\"wfl-voted\", feature.userVote === \"up\");\n      downBtn.classList.toggle(\"wfl-voted\", feature.userVote === \"down\");\n      voteCount.textContent = feature.votes;\n      voteCount.classList.remove(\"wfl-vote-positive\", \"wfl-vote-negative\");\n      if (feature.votes > 0) {\n        voteCount.classList.add(\"wfl-vote-positive\");\n      } else if (feature.votes < 0) {\n        voteCount.classList.add(\"wfl-vote-negative\");\n      }\n\n      // Animation\n      voteCount.classList.add(\"wfl-animating\");\n      setTimeout(() => voteCount.classList.remove(\"wfl-animating\"), 300);\n\n      // Confetti on upvote\n      if (action === \"up\" && newVoteType === \"up\") {\n        this.createConfetti(upBtn);\n      }\n\n      try {\n        const result = await this.api.vote(id, newVoteType);\n\n        // Sync with server response\n        feature.votes = result.totalVotes;\n        feature.userVote = result.vote;\n        voteCount.textContent = feature.votes;\n        voteCount.classList.remove(\"wfl-vote-positive\", \"wfl-vote-negative\");\n        if (feature.votes > 0) {\n          voteCount.classList.add(\"wfl-vote-positive\");\n        } else if (feature.votes < 0) {\n          voteCount.classList.add(\"wfl-vote-negative\");\n        }\n      } catch (error) {\n        console.error(\"WPFeatureLoop: Failed to save vote\", error);\n        // Revert to original values\n        feature.votes = originalVotes;\n        feature.userVote = originalUserVote;\n\n        upBtn.classList.toggle(\"wfl-voted\", feature.userVote === \"up\");\n        downBtn.classList.toggle(\"wfl-voted\", feature.userVote === \"down\");\n        voteCount.textContent = feature.votes;\n        voteCount.classList.remove(\"wfl-vote-positive\", \"wfl-vote-negative\");\n        if (feature.votes > 0) {\n          voteCount.classList.add(\"wfl-vote-positive\");\n        } else if (feature.votes < 0) {\n          voteCount.classList.add(\"wfl-vote-negative\");\n        }\n\n        this.showToast(this.t.errorText, \"error\");\n      } finally {\n        upBtn.disabled = false;\n        downBtn.disabled = false;\n      }\n    }\n\n    /**\n     * Create confetti animation\n     */\n    createConfetti(element) {\n      const colors = [\"#6366f1\", \"#8b5cf6\", \"#ec4899\", \"#10b981\", \"#f59e0b\"];\n      const rect = element.getBoundingClientRect();\n\n      for (let i = 0; i < 6; i++) {\n        const confetti = document.createElement(\"div\");\n        confetti.className = \"wfl-confetti\";\n        confetti.style.left = `${rect.left + rect.width / 2 + (Math.random() - 0.5) * 30}px`;\n        confetti.style.top = `${rect.top + rect.height / 2}px`;\n        confetti.style.background =\n          colors[Math.floor(Math.random() * colors.length)];\n        confetti.style.position = \"fixed\";\n        document.body.appendChild(confetti);\n\n        setTimeout(() => confetti.remove(), 600);\n      }\n    }\n\n    /**\n     * Show toast notification\n     */\n    showToast(message, type = \"default\") {\n      const toast = this.container.querySelector(\"#wfl-toast\");\n      if (!toast) return;\n\n      toast.textContent = message;\n      toast.className = \"wfl-toast wfl-active\";\n\n      if (type === \"success\") {\n        toast.classList.add(\"wfl-toast-success\");\n      } else if (type === \"error\") {\n        toast.classList.add(\"wfl-toast-error\");\n      }\n\n      setTimeout(() => {\n        toast.classList.remove(\"wfl-active\");\n      }, 3000);\n    }\n\n    /**\n     * Get all features\n     */\n    getFeatures() {\n      return [...this.features];\n    }\n\n    /**\n     * Refresh features from API\n     */\n    async refresh() {\n      this.isLoading = true;\n      this.renderSkeleton();\n\n      try {\n        this.features = await this.api.getFeatures();\n        this.isLoading = false;\n        this.hasError = false;\n        this.render();\n      } catch (error) {\n        console.error(\"WPFeatureLoop: Failed to refresh features\", error);\n        this.isLoading = false;\n        this.hasError = true;\n        this.renderError();\n      }\n    }\n\n    /**\n     * Destroy the widget\n     */\n    destroy() {\n      if (this.container) {\n        this.container.innerHTML = \"\";\n        this.container.classList.remove(\"wfl-container\");\n      }\n    }\n  }\n\n  /**\n   * Static init method for convenience\n   */\n  WPFeatureLoop.init = function (config) {\n    const instance = new WPFeatureLoop(config);\n    instance.init();\n    return instance;\n  };\n\n  /**\n   * Version\n   */\n  WPFeatureLoop.version = \"1.1.0\";\n\n  return WPFeatureLoop;\n});\n"],"names":["require_wpfeatureloop_es","__commonJSMin","exports","module","global","factory","this","styles","injectStyles","styleElement","icons","translations","ApiService","config","_a","_b","_c","response","data","error","featureId","voteType","text","feature","WPFeatureLoop","skeletonCards","featuresHtml","f","voteClass","upVoted","downVoted","commentText","tag","status","labels","comments","c","addBtn","modal","modalClose","modalCancel","modalSubmit","e","commentModal","commentClose","card","btn","commentTrigger","title","description","submitBtn","newFeature","commentsList","commentTitle","commentInput","self","handleSubmit","input","newComment","oldSubmit","oldInput","newSubmit","newInput","id","action","voteCount","upBtn","downBtn","originalVotes","originalUserVote","newVoteType","voteDelta","result","element","colors","rect","i","confetti","message","type","toast","instance"],"mappings":"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"}